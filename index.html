<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Gleichungstrainer – lineare Gleichungen</title>
<style>
  body{
    font-family:system-ui,Arial,sans-serif;
    margin:0;
    padding:24px;
    text-align:center;
    background:linear-gradient(to bottom right,#eef2ff,#e0f7fa);
    font-size:18px;
  }
  h1{
    margin:10px 0 20px;
    font-size:2.1em;
    color:#333;
  }
  #equation{
    font-size:2em;
    margin:20px auto 25px;
    font-weight:bold;
  }
  #stepsBox{
    margin:0 auto;
    max-width:900px;
    background:#ffffffcc;
    border-radius:16px;
    padding:24px;
    text-align:left;
  }

  .stepRow{
    margin:20px 0 24px;
  }
  .stepTitle{
    font-weight:bold;
    color:#007bff;
    font-size:1.2em;
    margin-bottom:10px;
  }

  .stepLine{
    display:flex;
    align-items:center;
    gap:12px;
    margin-bottom:6px;
  }
  .stepInput{
    flex:1;
    box-sizing:border-box;
    padding:10px 12px;
    font-size:1.2em;
    border-radius:10px;
    border:1px solid #888;
    font-family:monospace;
  }
  .stepInput:focus{
    outline:none;
    border-color:#007bff;
    box-shadow:0 0 0 2px #007bff33;
  }
  .eqSign{
    font-size:1.6em;
    font-weight:bold;
    padding:0 6px;
  }

  button{
    background:#007bff;
    color:white;
    border:none;
    padding:10px 16px;
    border-radius:10px;
    cursor:pointer;
    font-size:1.05em;
    white-space:nowrap;
  }
  button:hover{
    background:#0056b3;
  }
  .smallBtn{
    padding:10px 12px;
    font-size:1.05em;
  }

  .fb{
    font-size:1em;
    margin-top:4px;
    min-height:1.4em;
  }
  .ok{color:#2e7d32;}
  .err{color:#c62828;}

  #newEqBtn{
    display:block;
    margin:10px auto 0;
    padding:12px 20px;
    font-size:1.2em;
  }
</style>
</head>
<body>

<h1>Gleichungstrainer – lineare Gleichungen</h1>

<div id="equation">Lade Aufgabe ...</div>

<div id="stepsBox">

  <!-- Schritt 1 -->
  <div class="stepRow">
    <div class="stepTitle">1. Gleichartige Glieder ordnen</div>
    <div class="stepLine">
      <input type="text" id="step1Left" class="stepInput" placeholder="linke Seite">
      <span class="eqSign">=</span>
      <input type="text" id="step1Right" class="stepInput" placeholder="rechte Seite">
      <button data-step="1" class="checkBtn smallBtn">prüfen</button>
    </div>
    <div id="step1Fb" class="fb"></div>
  </div>

  <!-- Schritt 2 -->
  <div class="stepRow">
    <div class="stepTitle">2. Gleichartige Glieder zusammenfassen</div>
    <div class="stepLine">
      <input type="text" id="step2Left" class="stepInput" placeholder="linke Seite">
      <span class="eqSign">=</span>
      <input type="text" id="step2Right" class="stepInput" placeholder="rechte Seite">
      <button data-step="2" class="checkBtn smallBtn">prüfen</button>
    </div>
    <div id="step2Fb" class="fb"></div>
  </div>

  <!-- Schritt 3 -->
  <div class="stepRow">
    <div class="stepTitle">3. x-Glieder auf eine Seite bringen</div>
    <div class="stepLine">
      <input type="text" id="step3Left" class="stepInput" placeholder="linke Seite">
      <span class="eqSign">=</span>
      <input type="text" id="step3Right" class="stepInput" placeholder="rechte Seite">
      <button data-step="3" class="checkBtn smallBtn">prüfen</button>
    </div>
    <div id="step3Fb" class="fb"></div>
  </div>

  <!-- Schritt 4 -->
  <div class="stepRow">
    <div class="stepTitle">4. Zahlen auf die andere Seite bringen</div>
    <div class="stepLine">
      <input type="text" id="step4Left" class="stepInput" placeholder="linke Seite">
      <span class="eqSign">=</span>
      <input type="text" id="step4Right" class="stepInput" placeholder="rechte Seite">
      <button data-step="4" class="checkBtn smallBtn">prüfen</button>
    </div>
    <div id="step4Fb" class="fb"></div>
  </div>

  <!-- Schritt 5 -->
  <div class="stepRow">
    <div class="stepTitle">5. Nach x auflösen</div>
    <div class="stepLine">
      <input type="text" id="step5Left" class="stepInput" placeholder="linke Seite">
      <span class="eqSign">=</span>
      <input type="text" id="step5Right" class="stepInput" placeholder="rechte Seite">
      <button data-step="5" class="checkBtn smallBtn">prüfen</button>
    </div>
    <div id="step5Fb" class="fb"></div>
  </div>

  <button id="newEqBtn">Neue Gleichung</button>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {

  const equationEl = document.getElementById("equation");

  const steps = [
    { left: step1Left, right: step1Right, fb: step1Fb },
    { left: step2Left, right: step2Right, fb: step2Fb },
    { left: step3Left, right: step3Right, fb: step3Fb },
    { left: step4Left, right: step4Right, fb: step4Fb },
    { left: step5Left, right: step5Right, fb: step5Fb }
  ];

  const checkButtons = document.querySelectorAll(".checkBtn");
  const newEqBtn = document.getElementById("newEqBtn");

  function normalizeMinus(s){
    return s.replace(/−/g,"-");
  }

  function parseSide(str){
    str = normalizeMinus(str).replace(/\s+/g,"");
    if(str==="") return {cx:0,c0:0};
    if(str[0] !== "+" && str[0] !== "-") str = "+"+str;
    const terms = str.match(/[+\-][^+\-]+/g) || [];
    let cx = 0, c0 = 0;
    for(const t of terms){
      const sign = t[0]==="-"?-1:1;
      const body = t.slice(1);
      if(body.includes("x")){
        const coeffStr = body.replace("x","");
        const coeff = coeffStr==="" ? 1 : parseFloat(coeffStr);
        cx += sign * coeff;
      }else{
        const n = parseFloat(body);
        if(!isNaN(n)) c0 += sign * n;
      }
    }
    return {cx,c0};
  }

  function canonEq(eqStr){
    const parts = eqStr.split("=");
    if(parts.length !== 2) return null;
    const L = parseSide(parts[0]);
    const R = parseSide(parts[1]);
    return {ax: L.cx - R.cx, b: L.c0 - R.c0};
  }

  function equivalent(eq1, eq2){
    const c1 = canonEq(eq1);
    const c2 = canonEq(eq2);
    if(!c1 || !c2) return false;
    const a1=c1.ax, b1=c1.b;
    const a2=c2.ax, b2=c2.b;
    if(a1===0 && b1===0 && a2===0 && b2===0) return true;
    return (a1*b2 === a2*b1);
  }

  function solveFromCanon(c){
    if(!c || c.ax===0) return null;
    return -c.b / c.ax;
  }

  function parseSolutionLineFromParts(leftStr,rightStr){
    const L = leftStr.replace(/\s+/g,"");
    const R = rightStr.replace(/\s+/g,"");
    if(L==="x" && /^-?\d+$/.test(R)) return parseInt(R,10);
    if(R==="x" && /^-?\d+$/.test(L)) return parseInt(L,10);
    return null;
  }

  function generateEquation(){
    function randInt(min,max){return Math.floor(Math.random()*(max-min+1))+min;}
    function decompose(k){
      if(k===0) return [];
      const parts=[];
      let rest=k;
      const count = 2 + Math.floor(Math.random()*2);
      for(let i=0;i<count-1;i++){
        const range = Math.max(1,Math.floor(Math.abs(rest)));
        const val = randInt(-range,range);
        parts.push(val); rest -= val;
      }
      parts.push(rest);
      return parts.filter(v=>v!==0);
    }
    function shuffle(a){
      for(let i=a.length-1;i>0;i--){
        const j=Math.floor(Math.random()*(i+1));
        [a[i],a[j]]=[a[j],a[i]];
      }
    }
    function sideToString(terms){
      let out="", first=true;
      for(const t of terms){
        const coef=t.coef;
        if(coef===0) continue;
        const sign=coef>=0?"+":"-";
        const abs=Math.abs(coef);
        const piece=(t.kind==="x")?(abs===1?"x":abs+"x"):String(abs);
        if(first){ out+=(sign==="+"?piece:"-"+piece); first=false; }
        else out+=" "+sign+" "+piece;
      }
      return out||"0";
    }

    let x0;
    do{x0 = randInt(-5,5);}while(x0===0);

    let A,C;
    do{A = randInt(-6,6);}while(A===0);
    do{C = randInt(-6,6);}while(C===0 || C===A);

    const B = randInt(-20,20);
    const D = A*x0 + B - C*x0;

    const xL = decompose(A).map(k=>({kind:"x",coef:k}));
    const cL = decompose(B).map(k=>({kind:"c",coef:k}));
    const xR = decompose(C).map(k=>({kind:"x",coef:k}));
    const cR = decompose(D).map(k=>({kind:"c",coef:k}));

    let L=[...xL,...cL], R=[...xR,...cR];
    shuffle(L); shuffle(R);

    const lhs = sideToString(L);
    const rhs = sideToString(R);

    return {equation: lhs+" = "+rhs, solution:x0};
  }

  let originalEq = "";
  let canonOriginal = null;
  let trueSolution = null;

  function setFb(el,text,ok){
    el.textContent=text;
    el.className="fb " + (ok?"ok":"err");
  }
  function clearFb(el){
    el.textContent="";
    el.className="fb";
  }

  function newEquation(){
    const gen = generateEquation();
    originalEq = gen.equation;
    canonOriginal = canonEq(originalEq);
    trueSolution = solveFromCanon(canonOriginal);

    equationEl.textContent = "Aufgabe: " + originalEq;

    steps.forEach(s=>{
      s.left.value="";
      s.right.value="";
      clearFb(s.fb);
    });
    steps[0].left.focus();
  }

  function checkStep(i){
    const s = steps[i];
    const left=s.left.value.trim();
    const right=s.right.value.trim();

    if(!left || !right){
      setFb(s.fb,"Bitte beide Seiten eingeben.",false);
      return;
    }

    const eq = left+" = "+right;

    if(i===4){
      const sol=parseSolutionLineFromParts(left,right);
      if(sol===null){ setFb(s.fb,"Lösung muss x = Zahl sein.",false); return; }
      if(sol===trueSolution) setFb(s.fb,"✅ richtig!",true);
      else setFb(s.fb,"❌ falsch.",false);
      return;
    }

    if(!equivalent(originalEq,eq)){
      setFb(s.fb,"❌ nicht äquivalent zur ursprünglichen Gleichung.",false);
      return;
    }

    setFb(s.fb,"✅ richtig.",true);
  }

  checkButtons.forEach(btn=>{
    btn.addEventListener("click",()=>{
      const i=parseInt(btn.dataset.step,10)-1;
      checkStep(i);
    });
  });

  steps.forEach((s,i)=>{
    [s.left,s.right].forEach(inp=>{
      inp.addEventListener("keydown",e=>{
        if(e.key==="Enter") checkStep(i);
      });
    });
  });

  newEqBtn.addEventListener("click",newEquation);

  newEquation();
});
</script>

</body>
</html>
